<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title></title>
    <link rel="stylesheet" href="">
</head>

<body>
    <input type="file" class="file" name="imgfile" id="imgfile" placeholder="请选择文件">
    <img src="" id="showImg">
    <img src="" id="showImg_min">
    <canvas id="can"></canvas>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js" type="text/javascript"></script>
    <script>
        let input = document.getElementById("imgfile");
        //检测浏览器是否支持FileReader
        if (typeof(FileReader) === 'undefined') {
            result.innerHTML = "抱歉，你的浏览器不支持 FileReader，请使用现代浏览器操作！";
            input.setAttribute('disabled', 'disabled');
        } else {
            //开启监听
            input.addEventListener('change', readFile, false);
        }
        let suofang = function(base64, bili, callback) {
            console.log("执行缩放程序,bili=" + bili);
            //处理缩放，转格式
            let _img = new Image();
            _img.src = base64;
            _img.onload = function() {
                let _canvas = document.getElementById("can");
                let w = this.width / bili;
                let h = this.height / bili;
                _canvas.setAttribute("width", w);
                _canvas.setAttribute("height", h);
                _canvas.getContext("2d").drawImage(this, 0, 0, w, h);
                var base64_ok = _canvas.toDataURL("image/jpeg",0.1);
                
                $("#showImg_min").attr("src", base64_ok);

            }
        }

        function readFile() {
            let file = this.files[0];
            let reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = function(e) {
                base64Code = this.result;
                //把得到的base64赋值到img标签显示
                $("#showImg").attr("src", base64Code);
                suofang(base64Code, 2)

            }
        }
    </script>


</body>

</html>